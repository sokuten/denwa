// 修正版：ネットワークの断片（Candidate）が集まるのを待たずにQRを出す
  const s=(isOffer)=>{
    const gen = () => {
      const sdp = JSON.stringify(pc.localDescription);
      const url = window.location.origin + window.location.pathname + '?s=' + btoa(sdp);
      t.value = url;
      qd.innerHTML = "";
      new QRCode(qd, { text: url, width: 200, height: 200 });
      if(isOffer) { b3.disabled = false; }
    };
    
    // 住所の一部が確定した瞬間、または1秒後に強制的にQRを生成
    pc.onicecandidate = e => { if(!e.candidate) gen(); };
    setTimeout(gen, 1000); 
  };
